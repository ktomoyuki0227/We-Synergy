# 🧭 要件定義書（ver.3：ルーム機能削除・全員共通リアルタイム版）

## プロジェクト名
**We = Synergy**

---

## 1. アプリ概要

「We = Synergy」は、誰でもアクセスするだけで参加できる**リアルタイム発想支援アプリ**です。  
ユーザーは匿名でキーワードを投稿し、システムがランダムに2つのキーワードを選んで  
画面全体に共有表示します。  
参加者はその組み合わせから自由にアイデアを発想し、  
発想を共有・投票することで場を盛り上げることを目的とします。

---

## 2. 想定環境・技術スタック

| 分類 | 使用技術 | 目的・理由 |
|------|-----------|-------------|
| フロントエンド | Next.js 14 (App Router) | SSR/CSR対応。Supabase連携に最適。 |
| 言語 | TypeScript | 型安全な実装。予期せぬバグを減らす。 |
| UI | Tailwind CSS + shadcn/ui + Framer Motion | シンプルかつ動きのあるUIを素早く構築。 |
| 状態管理 | Zustand | 軽量な状態管理。ルーム不要構成に最適。 |
| バックエンド | Supabase (PostgreSQL + Edge Functions) | DB・Auth・Realtimeが統合。BaaSとして最適。 |
| 認証 | Supabase Auth（匿名ログイン） | ルーム不要で自動参加を実現。 |
| リアルタイム通信 | Supabase Realtime API | 投稿・抽選・結果共有を即時反映。 |
| デプロイ | Vercel | Next.js公式ホスティング。簡易デプロイ。 |
| CI/CD | GitHub Actions | 自動テスト・自動デプロイ。 |
| テスト | Vitest / Playwright | 単体テストとE2Eテストを統合。 |
| 監視 | Sentry / Logflare | エラー・動作ログの可視化。 |

---

## 3. システム構成概要

```

[ フロントエンド ]
Next.js + Tailwind + shadcn/ui
↓
Supabase Realtime API（global_keywords / global_history）
↓
[ バックエンド ]
Supabase Edge Functions
└─ 抽選ロジック / AI補助（将来的）
↓
[ データベース ]
Supabase (PostgreSQL)
└─ users / keywords / history テーブル
↓
[ デプロイ環境 ]
Vercel + GitHub Actions

````

---

## 4. データモデル（ルームなし構成）

### 4.1 users テーブル
| カラム名 | 型 | 説明 |
|-----------|----|------|
| id | uuid | ユーザーID（匿名Auth） |
| name | text | ニックネーム（任意入力） |
| created_at | timestamp | 登録日時 |

### 4.2 keywords テーブル
| カラム名 | 型 | 説明 |
|-----------|----|------|
| id | uuid | キーワードID |
| user_id | uuid | 投稿者ID |
| word | text | 投稿キーワード |
| created_at | timestamp | 投稿日時 |

### 4.3 history テーブル
| カラム名 | 型 | 説明 |
|-----------|----|------|
| id | uuid | 抽選履歴ID |
| keyword_a | text | 抽選キーワードA |
| keyword_b | text | 抽選キーワードB |
| created_at | timestamp | 抽選日時 |

---

## 5. 機能要件

| 機能名 | 概要 | 入出力 |
|---------|------|---------|
| 匿名ログイン | ページアクセス時に自動ログイン | 出：ユーザーID発行 |
| キーワード投稿 | ユーザーが単語を入力・送信 | 入：文字列 → 出：DB保存・全クライアントへ反映 |
| ランダム抽選 | 投稿済みキーワードから2つ選出 | 入：なし → 出：keyword_a, keyword_b |
| 結果表示 | 選ばれたキーワードを全員に表示 | 入：keyword_a, keyword_b → 出：画面更新 |
| タイマー | 制限時間を共通で表示 | 入：秒数 → 出：残り時間更新 |
| 投票 | 「いいね」または「👍」を送信 | 入：選択ID → 出：スコア更新 |
| 履歴表示 | 過去の抽選結果を表示 | 入：なし → 出：履歴リスト |

---

## 6. 非機能要件

| 項目 | 内容 |
|------|------|
| 同時接続数 | 最大10〜20人想定 |
| 応答速度 | 抽選結果表示まで1秒以内 |
| デバイス対応 | PC / モバイル両対応（レスポンシブ） |
| 保存期間 | 投稿・履歴データは短期保存（例：24時間） |
| UI/UX | ミニマルかつ遊び心のある体験重視 |

---

## 7. 処理フロー

1️⃣ ページアクセス  
→ Supabase匿名Authでユーザー識別  

2️⃣ キーワード投稿  
→ Supabase `keywords` に insert  
→ Realtime APIで全参加者に即時反映  

3️⃣ ランダム抽選（Edge Function）  
→ `keywords` から2件ランダム取得  
→ `history` に保存  
→ `global_history` チャンネルで配信  

4️⃣ 結果表示  
→ 全ユーザーの画面に同時表示  
→ Framer Motionで演出  

5️⃣ タイマー終了後  
→ 次の投稿または再抽選が可能  

---

## 8. API仕様

### `POST /api/drawKeywords`
投稿済みのキーワードから2つをランダムに抽出して返す。

**Request**
```json
{}
````

**Response**

```json
{
  "keyword_a": "AI",
  "keyword_b": "おにぎり"
}
```

---

## 9. 画面構成（UIフロー）

1. **キーワード投稿画面**

   * テキスト入力欄＋送信ボタン
   * 現在の参加者の投稿リストをリアルタイム表示

2. **結果表示画面**

   * 「AI × おにぎり」形式で大きく表示
   * カウントダウンタイマーを中央に配置

3. **共有・投票画面**

   * 各ユーザーのアイデア一覧
   * 「👍」ボタンによる投票

4. **履歴画面**

   * 過去の抽選結果を一覧表示

---

## 10. 状態管理設計（Zustand）

| 状態名       | 型                       | 説明              |
| --------- | ----------------------- | --------------- |
| keywords  | string[]                | 現在投稿されている全キーワード |
| selected  | [string, string] | null | 現在選ばれたキーワードペア   |
| isDrawing | boolean                 | 抽選中かどうか         |
| timer     | number                  | 残り時間（秒）         |

> Zustandで状態を一元管理し、Supabase Realtimeイベントを監視して更新。
> ページ間遷移なし・即時反映を実現。

---

## 11. 将来的拡張

| 項目   | 内容                              |
| ---- | ------------------------------- |
| AI補助 | OpenAI / Gemini APIで例示アイデアを自動生成 |
| 音声出力 | SpeechSynthesis APIでお題を読み上げ     |
| PWA化 | Expo Routerでスマホホーム画面対応          |
| 分析機能 | Supabase SQL + Grafanaで投稿傾向可視化  |

---

## 12. デザイン指針

* ロゴ：「We = Synergy」内の“=”を象徴モチーフ化
* 配色：白ベース × アクセントブルー
* フォント：Noto Sans JP
* モーション：Framer Motionでフェード／スライド演出

---

## 13. 開発スケジュール（目安）

| フェーズ  | 内容                        | 期間         |
| ----- | ------------------------- | ---------- |
| フェーズ1 | 要件定義・UIモック（Figma）         | 〜2025/10月末 |
| フェーズ2 | MVP開発（Next.js + Supabase） | 11月上旬      |
| フェーズ3 | テスト・デバッグ                  | 11月中旬      |
| フェーズ4 | βリリース（Finding AI内で試用）     | 11月末       |
| フェーズ5 | 正式版公開                     | 12月予定      |

---

✅ **最終目的**
Codexが本ドキュメントをもとに、

* ルーム不要構成（全員共通チャンネル）
* Zustandによる状態管理
* Supabase Realtimeによる即時同期
  を含むNext.jsコードベースを自動生成できることを目的とする。

```