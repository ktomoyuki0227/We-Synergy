# 🧭 要件定義書（Codex向け構成）

## プロジェクト名

**We = Synergy**

---

## 1. アプリ概要

本アプリは、複数人がそれぞれ出した「キーワード」からランダムに2つを選び、
その組み合わせをもとに**ビジネスアイデアを発想するアイスブレイクアプリ**です。

主な目的は以下の通り：

* チームビルディングや授業などで**会話のきっかけを生む**
* ランダムな発想を通して**共創的思考を促す**
* オンラインでも対面でも**リアルタイムで共有体験できる**

---

## 2. 想定環境・技術スタック

| 分類       | 使用技術                                     | 目的・理由                               |
| -------- | ---------------------------------------- | ----------------------------------- |
| フロントエンド  | Next.js 14 (App Router)                  | ReactベースでSSR/CSR両対応。Supabaseとの相性良好。 |
| 言語       | TypeScript                               | 型安全な実装。バグ検知と補完性能を向上。                |
| UI       | Tailwind CSS + shadcn/ui + Framer Motion | シンプルかつアニメーション付きのUIを高速構築。            |
| 状態管理     | Zustand                                  | 軽量な状態管理（Contextより高速）。               |
| バックエンド   | Supabase (PostgreSQL + Edge Functions)   | 認証・DB・リアルタイム通信を統合的に提供。              |
| 認証       | Supabase Auth                            | 匿名またはMagicLink認証対応。                 |
| リアルタイム通信 | Supabase Realtime API                    | WebSocketでルーム内データを同期。               |
| デプロイ     | Vercel                                   | Next.js公式ホスティング。Supabaseと連携が容易。     |
| CI/CD    | GitHub Actions                           | テスト・デプロイ自動化。                        |
| テスト      | Vitest / Playwright                      | 単体・E2Eテストを統合。                       |
| モニタリング   | Sentry / Logflare                        | エラートラッキング・ログ管理。                     |

---

## 3. システム構成概要

### 3.1 全体構成図（概念）

```
[ フロントエンド ]
Next.js + Tailwind + shadcn/ui
↓
Supabase Realtime API 経由で同期
↓
[ バックエンド ]
Supabase Edge Functions
  └─ 抽選ロジック / AI補助API（将来的）
↓
[ データベース ]
Supabase (PostgreSQL)
  └─ users / rooms / keywords / history テーブル
↓
[ デプロイ環境 ]
Vercel + GitHub Actions
```

---

## 4. データモデル（想定）

### 4.1 users テーブル

| カラム名       | 型         | 説明                      |
| ---------- | --------- | ----------------------- |
| id         | uuid      | ユーザーID（Supabase Auth連携） |
| name       | text      | ニックネーム                  |
| created_at | timestamp | 登録日時                    |

### 4.2 rooms テーブル

| カラム名       | 型         | 説明    |
| ---------- | --------- | ----- |
| id         | uuid      | ルームID |
| name       | text      | ルーム名  |
| host_id    | uuid      | 作成者ID |
| created_at | timestamp | 作成日時  |

### 4.3 keywords テーブル

| カラム名       | 型         | 説明      |
| ---------- | --------- | ------- |
| id         | uuid      | キーワードID |
| room_id    | uuid      | 所属ルーム   |
| user_id    | uuid      | 投稿者ID   |
| word       | text      | 投稿キーワード |
| created_at | timestamp | 投稿日時    |

### 4.4 history テーブル

| カラム名       | 型         | 説明       |
| ---------- | --------- | -------- |
| id         | uuid      | 履歴ID     |
| room_id    | uuid      | 所属ルーム    |
| keyword_a  | text      | 抽選キーワードA |
| keyword_b  | text      | 抽選キーワードB |
| created_at | timestamp | 抽選日時     |

---

## 5. 機能要件

### 5.1 コア機能一覧

| 機能名     | 概要               | 入出力                                |
| ------- | ---------------- | ---------------------------------- |
| ルーム作成   | 新しいルームを生成        | 入：ルーム名、ユーザー名 → 出：ルームID             |
| ルーム参加   | ルームIDを入力して参加     | 入：ルームID、ユーザー名 → 出：参加完了             |
| キーワード入力 | 各ユーザーが単語を入力・送信   | 入：文字列 → 出：DBに保存、他クライアントへ反映         |
| ランダム抽選  | ルーム内のキーワードから2つ選出 | 入：room_id → 出：keyword_a, keyword_b |
| 結果表示    | 選出結果をリアルタイム表示    | 入：keyword_a, keyword_b → 出：画面表示    |
| タイマー    | 発想制限時間のカウント表示    | 入：時間（秒）→ 出：残り時間更新                  |
| アイデア共有  | ユーザーが発想を書き込む     | 入：テキスト → 出：DB保存（任意）                |
| 投票機能    | 「いいね」ボタン押下       | 入：idea_id → 出：スコア加算（任意）            |
| 履歴参照    | 過去の組み合わせ一覧を表示    | 入：room_id → 出：履歴配列                 |

---

## 6. 非機能要件

| 項目     | 内容                        |
| ------ | ------------------------- |
| 最大同時接続 | 10人程度（小規模ワーク想定）           |
| 応答速度   | 抽選結果表示まで1秒以内              |
| デバイス対応 | モバイル / PC（レスポンシブ必須）       |
| 保存期間   | ルーム終了時に自動削除（匿名運用）         |
| UI/UX  | シンプルで視認性が高い。モーションで遊び心を演出。 |

---

## 7. 処理フロー

1. ユーザーがルームを作成
   → Supabaseでroomレコードを生成
   → Authでユーザー識別

2. 参加者がキーワードを入力
   → Supabaseにinsert
   → Realtime APIで全クライアントへbroadcast

3. ランダム抽選を実行（Edge Function）
   → keywordsテーブルからランダムで2件取得
   → historyに保存

4. 結果を全員に配信
   → Realtime APIで通知
   → Next.js側で表示＋Framer Motion演出

5. タイマー終了後、次ラウンドへ
   → 状態リセット → 再抽選可

---

## 8. API仕様（例）

### `POST /api/createRoom`

ルームを新規作成。

**Request**

```json
{
  "name": "Team Alpha",
  "user_name": "Tomo"
}
```

**Response**

```json
{
  "room_id": "uuid-string"
}
```

---

### `POST /api/drawKeywords`

2つのキーワードをランダムに選出。

**Request**

```json
{
  "room_id": "uuid-string"
}
```

**Response**

```json
{
  "keyword_a": "AI",
  "keyword_b": "おにぎり"
}
```

---

## 9. 画面構成（UIフロー）

1. **トップ画面**
   　- 「ルーム作成」ボタン
   　- 「ルーム参加」フォーム

2. **キーワード入力画面**
   　- 入力フィールド＋送信ボタン
   　- 他ユーザーの入力状況を一覧表示

3. **結果表示画面**
   　- ランダム抽選結果「A × B」
   　- カウントダウンタイマー

4. **共有画面**
   　- 各自のアイデアを投稿または口頭共有

5. **履歴画面**
   　- 過去の組み合わせ一覧を表示

---

## 10. 将来的拡張（設計上考慮）

| 項目       | 内容                                              |
| -------- | ----------------------------------------------- |
| AI連携     | OpenAI / Gemini APIをEdge Functionで統合し、例示アイデアを提示 |
| 音声出力     | SpeechSynthesis APIによる結果読み上げ                    |
| モバイルアプリ化 | Expo RouterでPWA化・ネイティブ化対応                       |
| 分析機能     | Supabase SQL + Grafanaで利用傾向可視化                  |

---

## 11. デザイン指針

* ロゴ：「We = Synergy」内の “=” を象徴モチーフ化
* カラートーン：白 × アクセントブルー
* フォント：Noto Sans JP（軽量・視認性重視）
* モーション：Framer Motionでフェード・拡大演出

---

## 12. 開発スケジュール（目安）

| フェーズ  | 内容                        | 期間         |
| ----- | ------------------------- | ---------- |
| フェーズ1 | 要件定義・UIモック（Figma）         | 〜2025/10月末 |
| フェーズ2 | MVP開発（Next.js + Supabase） | 11月上旬      |
| フェーズ3 | テスト・機能追加                  | 11月中旬      |
| フェーズ4 | βリリース（学内・イベント利用）          | 11月末       |
| フェーズ5 | 正式版公開                     | 12月予定      |

---

✅ **最終目的：**
Codexが本書を基に、

* Next.js / Supabase構成のコードベースを自動生成できるように
* フロント〜バックのデータフローが一貫して理解できるように
  構造・命名・データモデルを明確化している。
